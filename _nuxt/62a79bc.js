(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{231:function(t,e,r){var content=r(399);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(53).default)("8f21414a",content,!0,{sourceMap:!1})},232:function(t,e,r){var content=r(401);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(53).default)("6759f5ab",content,!0,{sourceMap:!1})},378:function(t,e){},380:function(t,e){},397:function(t,e,r){var map={"./af":241,"./af.js":241,"./ar":242,"./ar-dz":243,"./ar-dz.js":243,"./ar-kw":244,"./ar-kw.js":244,"./ar-ly":245,"./ar-ly.js":245,"./ar-ma":246,"./ar-ma.js":246,"./ar-sa":247,"./ar-sa.js":247,"./ar-tn":248,"./ar-tn.js":248,"./ar.js":242,"./az":249,"./az.js":249,"./be":250,"./be.js":250,"./bg":251,"./bg.js":251,"./bm":252,"./bm.js":252,"./bn":253,"./bn.js":253,"./bo":254,"./bo.js":254,"./br":255,"./br.js":255,"./bs":256,"./bs.js":256,"./ca":257,"./ca.js":257,"./cs":258,"./cs.js":258,"./cv":259,"./cv.js":259,"./cy":260,"./cy.js":260,"./da":261,"./da.js":261,"./de":262,"./de-at":263,"./de-at.js":263,"./de-ch":264,"./de-ch.js":264,"./de.js":262,"./dv":265,"./dv.js":265,"./el":266,"./el.js":266,"./en-au":267,"./en-au.js":267,"./en-ca":268,"./en-ca.js":268,"./en-gb":269,"./en-gb.js":269,"./en-ie":270,"./en-ie.js":270,"./en-il":271,"./en-il.js":271,"./en-in":272,"./en-in.js":272,"./en-nz":273,"./en-nz.js":273,"./en-sg":274,"./en-sg.js":274,"./eo":275,"./eo.js":275,"./es":276,"./es-do":277,"./es-do.js":277,"./es-us":278,"./es-us.js":278,"./es.js":276,"./et":279,"./et.js":279,"./eu":280,"./eu.js":280,"./fa":281,"./fa.js":281,"./fi":282,"./fi.js":282,"./fil":283,"./fil.js":283,"./fo":284,"./fo.js":284,"./fr":285,"./fr-ca":286,"./fr-ca.js":286,"./fr-ch":287,"./fr-ch.js":287,"./fr.js":285,"./fy":288,"./fy.js":288,"./ga":289,"./ga.js":289,"./gd":290,"./gd.js":290,"./gl":291,"./gl.js":291,"./gom-deva":292,"./gom-deva.js":292,"./gom-latn":293,"./gom-latn.js":293,"./gu":294,"./gu.js":294,"./he":295,"./he.js":295,"./hi":296,"./hi.js":296,"./hr":297,"./hr.js":297,"./hu":298,"./hu.js":298,"./hy-am":299,"./hy-am.js":299,"./id":300,"./id.js":300,"./is":301,"./is.js":301,"./it":302,"./it-ch":303,"./it-ch.js":303,"./it.js":302,"./ja":304,"./ja.js":304,"./jv":305,"./jv.js":305,"./ka":306,"./ka.js":306,"./kk":307,"./kk.js":307,"./km":308,"./km.js":308,"./kn":309,"./kn.js":309,"./ko":310,"./ko.js":310,"./ku":311,"./ku.js":311,"./ky":312,"./ky.js":312,"./lb":313,"./lb.js":313,"./lo":314,"./lo.js":314,"./lt":315,"./lt.js":315,"./lv":316,"./lv.js":316,"./me":317,"./me.js":317,"./mi":318,"./mi.js":318,"./mk":319,"./mk.js":319,"./ml":320,"./ml.js":320,"./mn":321,"./mn.js":321,"./mr":322,"./mr.js":322,"./ms":323,"./ms-my":324,"./ms-my.js":324,"./ms.js":323,"./mt":325,"./mt.js":325,"./my":326,"./my.js":326,"./nb":327,"./nb.js":327,"./ne":328,"./ne.js":328,"./nl":329,"./nl-be":330,"./nl-be.js":330,"./nl.js":329,"./nn":331,"./nn.js":331,"./oc-lnc":332,"./oc-lnc.js":332,"./pa-in":333,"./pa-in.js":333,"./pl":334,"./pl.js":334,"./pt":335,"./pt-br":336,"./pt-br.js":336,"./pt.js":335,"./ro":337,"./ro.js":337,"./ru":338,"./ru.js":338,"./sd":339,"./sd.js":339,"./se":340,"./se.js":340,"./si":341,"./si.js":341,"./sk":342,"./sk.js":342,"./sl":343,"./sl.js":343,"./sq":344,"./sq.js":344,"./sr":345,"./sr-cyrl":346,"./sr-cyrl.js":346,"./sr.js":345,"./ss":347,"./ss.js":347,"./sv":348,"./sv.js":348,"./sw":349,"./sw.js":349,"./ta":350,"./ta.js":350,"./te":351,"./te.js":351,"./tet":352,"./tet.js":352,"./tg":353,"./tg.js":353,"./th":354,"./th.js":354,"./tl-ph":355,"./tl-ph.js":355,"./tlh":356,"./tlh.js":356,"./tr":357,"./tr.js":357,"./tzl":358,"./tzl.js":358,"./tzm":359,"./tzm-latn":360,"./tzm-latn.js":360,"./tzm.js":359,"./ug-cn":361,"./ug-cn.js":361,"./uk":362,"./uk.js":362,"./ur":363,"./ur.js":363,"./uz":364,"./uz-latn":365,"./uz-latn.js":365,"./uz.js":364,"./vi":366,"./vi.js":366,"./x-pseudo":367,"./x-pseudo.js":367,"./yo":368,"./yo.js":368,"./zh-cn":369,"./zh-cn.js":369,"./zh-hk":370,"./zh-hk.js":370,"./zh-mo":371,"./zh-mo.js":371,"./zh-tw":372,"./zh-tw.js":372};function n(t){var e=o(t);return r(e)}function o(t){if(!r.o(map,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return map[t]}n.keys=function(){return Object.keys(map)},n.resolve=o,t.exports=n,n.id=397},398:function(t,e,r){"use strict";var n=r(231);r.n(n).a},399:function(t,e,r){(e=r(52)(!1)).push([t.i,".line-chart[data-v-5d0205c6]{height:600px}",""]),t.exports=e},400:function(t,e,r){"use strict";var n=r(232);r.n(n).a},401:function(t,e,r){(e=r(52)(!1)).push([t.i,".loading-text{font-style:italic;color:#666}#displaySummaryControls label,#transactionTypeControls label{cursor:pointer}.nuxt-progress{background-color:#666}",""]),t.exports=e},403:function(t,e,r){"use strict";r.r(e);var n=r(373),o=r.n(n),l=(r(46),r(390),r(2),r(1),r(41),r(392),r(22)),c={name:"SummaryLineChart",components:{LineChart:{extends:r(402).a,props:["data","options"],mounted:function(){this.renderChart(this.data,this.options)},watch:{data:function(){this.renderChart(this.data,this.options)}}}},props:["lineChartData","years"],data:function(){return{lineChartOptions:{maintainAspectRatio:!1,scales:{yAxes:[{stacked:!0,ticks:{beginAtZero:!0,callback:function(t,e,r){return t.toLocaleString(void 0,{maximumFractionDigits:2})}},scaleLabel:{display:!0,labelString:"Value (GBP)"}}],xAxes:[{ticks:{callback:function(t){return t.length>=20?t.slice(0,t.length).substring(0,19).trim()+"...":t}}}]}}}},computed:{lineChartYears:function(){return Object(l.a)(this.years).reverse()}},methods:{makeDatasets:function(t){var e=this.lineChartYears,r=["#CF3D1E","#F15623","#F68B1F","#FFC60B","#DFCE21","#BCD631","#95C93D","#48B85C","#00833D","#00B48D","#60C4B1","#27C4F4","#478DCB","#3E67B1","#4251A3","#59449B","#6E3F7C","#6A246D","#8A4873","#EB0080","#EF58A0","#C05A89"];return{datasets:t.map((function(t,i){return{label:t.sector,borderColor:i<r.length?r[i]:"#eeeeee",backgroundColor:i<r.length?r[i]:"#eeeeee",fill:!0,data:e.map((function(e){return{x:e,y:t["value_".concat(e)]?Math.round(t["value_".concat(e)],2):0}}))}})),labels:e}}}},d=(r(398),r(47)),h={components:{LineChart:Object(d.a)(c,(function(){var t=this.$createElement;return(this._self._c||t)("LineChart",{staticClass:"line-chart",attrs:{data:this.makeDatasets(this.lineChartData),options:this.lineChartOptions}})}),[],!1,null,"5d0205c6",null).exports},data:function(){return{years:[]}},props:["activityData","displaySummary"],computed:{summaryData:function(){var t=new Set([]),e=Object.values(this.activityData.reduce((function(summary,e){return e.transactionsTable.reduce((function(e,r){var n=r.date.slice(0,4);t.add(n);var o=e[r.sector]?e[r.sector]:e[r.sector]={};return o.total_value?function(t,e){t.total_value+=parseFloat(e.value),t["value_".concat(n)]?t["value_".concat(n)]+=parseFloat(e.value):t["value_".concat(n)]=parseFloat(e.value)}(o,r):function(t,e){t.sector=e.sector,t.total_value=parseFloat(e.value),t["value_".concat(n)]=parseFloat(e.value)}(o,r),e}),summary)}),{})).sort((function(a,b){return a.total_value>b.total_value?1:-1})).reverse();return this.years=Array.from(t).sort().reverse(),e},summaryFields:function(){var t=[{key:"sector",sortable:!0},{key:"total_value",sortable:!0,thClass:"text-right",tdClass:"text-right",formatter:"valueFormatter"}];return this.years.forEach((function(i){t.push({key:"value_".concat(i),sortable:!0,thClass:"text-right",tdClass:"text-right",formatter:"valueFormatter"})})),t}},methods:{valueFormatter:function(t){return t?Math.round(t):0}}},m=Object(d.a)(h,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",["chart"===t.displaySummary?r("LineChart",{attrs:{lineChartData:t.summaryData,years:t.years}}):t._e(),t._v(" "),"table"===t.displaySummary?r("b-table",{attrs:{items:t.summaryData,fields:t.summaryFields,"asort-by":"total_value","asort-desc":"true",small:"","head-variant":"dark",bordered:""}}):t._e()],1)}),[],!1,null,null,null).exports,v={components:{},props:["activity","transactionType"],data:function(){return{currentPage:1,perPage:10,perPageOptions:[10,20,50,100,500,1e3],tableFields:[{key:"description",sortable:!0,thStyle:"width: 40px;"},{key:"sector",sortable:!0,thStyle:"width: 20px;"},{key:"date",sortable:!0,thStyle:"width: 20px;"},{key:"value",label:"Value (".concat(this.activity._attributes["default-currency"],")"),sortable:!0,thStyle:"width: 20px;",thClass:"text-right",tdClass:"text-right"}]}},computed:{transactionTypeName:function(){return"4"===this.transactionType?"expenditure":"revenue"}},methods:{getTotalExpenditure:function(t){var e=this;return t.transaction.filter((function(t){return t["transaction-type"]._attributes.code===e.transactionType&&parseInt(t["transaction-date"]._attributes["iso-date"].slice(0,4))>=2009})).reduce((function(t,e){return t+parseFloat(e.value._text)}),0)}}},y={loading:!1,components:{ActivityTable:Object(d.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-card",{staticStyle:{"margin-bottom":"20px"},attrs:{"bg-variant":"light"}},[r("b-btn",{staticClass:"float-right",attrs:{variant:"secondary",size:"sm",href:"http://d-portal.org/q.html?aid="+t.activity["iati-identifier"]._text}},[t._v("View on D-Portal")]),t._v(" "),r("h3",[t._v("\n    "+t._s(t.activity.title.narrative._text)+" (Total "+t._s(t.transactionTypeName)+": "+t._s(t.activity._attributes["default-currency"])+" "+t._s(t.getTotalExpenditure(t.activity).toLocaleString(void 0,{maximumFractionDigits:2}))+")\n  ")]),t._v(" "),r("p",{staticClass:"lead"},[t._v("\n    "+t._s(t.activity.description.narrative._text)+"\n  ")]),t._v(" "),r("p"),t._v(" "),r("no-ssr",[r("b-form-group",{attrs:{label:"Transactions per page","label-for":"perPage_"+t.activity["iati-identifier"]._text,"label-cols-sm":"4","label-cols-lg":"3"}},[r("b-form-select",{attrs:{id:"perPage_"+t.activity["iati-identifier"]._text,options:t.perPageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1),t._v(" "),r("b-table",{attrs:{id:"table_"+t.activity["iati-identifier"]._text,items:t.activity.transactionsTable,fields:t.tableFields,"per-page":t.perPage,"current-page":t.currentPage,small:"","head-variant":"dark",bordered:""}}),t._v(" "),r("no-ssr",[r("b-pagination",{attrs:{"total-rows":t.activity.transactionsTable.length,"per-page":t.perPage,"aria-controls":"table_"+t.activity["iati-identifier"]._text},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)}),[],!1,null,null,null).exports,SummaryTable:m},data:function(){return{activityData:null,displaySummary:"chart",transactionType:"4"}},methods:{makeTransactionsTable:function(t,e){return t.sort((function(a,b){return a["transaction-date"]._attributes["iso-date"]<b["transaction-date"]._attributes["iso-date"]?-1:1})).reverse(),(t=t.filter((function(t){return t["transaction-type"]._attributes.code===e.transactionType&&parseInt(t["transaction-date"]._attributes["iso-date"].slice(0,4))>=2009}))).map((function(t){return{description:t.description.narrative._text,sector:t.sector.narrative._text,date:t["transaction-date"]._attributes["iso-date"],value:t.value._text}}))},loadData:function(){var t=this,e=this;return this.$axios.$get("".concat("https://sage2iati.publishwhatyoufund.org/publish-what-you-fund/activity.xml"),{headers:{"X-Requested-With":"XMLHttpRequest"},progress:!1}).then((function(data){t.activityData=o.a.xml2js(data,{compact:!0})["iati-activities"]["iati-activity"].map((function(r){return void 0===r.transaction?(r.transaction=[],r.transactionsTable=[]):r.transactionsTable=t.makeTransactionsTable(r.transaction,e),r})).sort((function(a,b){return a["iati-identifier"]._text>b["iati-identifier"]._text?1:-1})),t.$nuxt.$loading.finish()})).catch((function(t){alert("Sorry, there was an error loading the data! Perhaps the IATI XML file moved or is currently unavailable? Try reloading the page."),console.log("Error loading data",t)}))}},watch:{transactionType:function(){var t=this;this.activityData=this.activityData.map((function(e){return e.transactionsTable=t.makeTransactionsTable(e.transaction,t),e}))}},mounted:function(){var t=this;this.$nextTick((function(){t.$nuxt.$loading.start(),t.loadData()}))}},f=(r(400),Object(d.a)(y,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container-fluid",staticStyle:{"margin-top":"20px"}},[r("div",[r("b-row",[r("b-col",{attrs:{md:"8"}},[r("h1",[t._v("\n          Publish What You Fund: Transparency\n        ")]),t._v(" "),r("h2",{staticStyle:{"font-style":"italic"}},[t._v("\n          A visualisation of our revenue and expenditure, based on our IATI data.\n        ")])]),t._v(" "),r("b-col",{staticClass:"text-md-right",attrs:{md:"4"}},[r("a",{attrs:{href:"https://www.publishwhatyoufund.org/"}},[r("img",{attrs:{src:"https://www.publishwhatyoufund.org/wp-content/themes/pwyf/assets/images/Publish-What-You-Fund-logo.svg",width:"300",alt:"Publish What You Fund"}})])])],1),t._v(" "),r("hr"),t._v(" "),r("p",{staticClass:"lead"},[t._v("The idea for this site was sparked by some debates about the appropriate granularity of open data and the limits of transparency. It can hopefully be seen as a contribution to those debates. The data published by Publish What You Fund about its own finances is possibly the most detailed and granular data released by any organisation. Presented here unchanged from the organisation's own IATI publication, it contains personnel costs aggregated by month, but otherwise every line item from the financial system is published. Revenue data is also published. The detailed expense classification (e.g. classification by salaries vs flights or hotel costs) is quite unique to Publish What You Fund's data; most other organisations publish much more aggregate data. The extent to which this approach could or should be replicated by other organisations is of course open for discussion.")]),t._v(" "),null==t.activityData?[r("h2",{staticClass:"loading-text"},[t._v("(Loading data...)")])]:t._e(),t._v(" "),null!=t.activityData?[r("h3",[t._v("Summary")]),t._v(" "),r("b-form-group",[r("b-form-radio-group",{attrs:{id:"displaySummaryControls",options:[{value:"chart",text:"Chart"},{value:"table",text:"Table"}],name:"displaySummaryControls",buttons:"","button-variant":"outline-primary"},model:{value:t.displaySummary,callback:function(e){t.displaySummary=e},expression:"displaySummary"}}),t._v(" "),r("b-form-radio-group",{attrs:{id:"transactionTypeControls",options:[{value:"4",text:"Expenditure"},{value:"1",text:"Revenue"}],name:"transactionTypeControls",buttons:"","button-variant":"outline-dark"},model:{value:t.transactionType,callback:function(e){t.transactionType=e},expression:"transactionType"}})],1),t._v(" "),t.activityData?r("SummaryTable",{attrs:{activityData:t.activityData,displaySummary:t.displaySummary}}):t._e(),t._v(" "),r("hr"),t._v(" "),r("h3",[t._v("Activity detail")]),t._v(" "),t._l(t.activityData,(function(e){return t.activityData?r("ActivityTable",{key:e["iati-identifier"]._text,attrs:{activity:e,transactionType:t.transactionType}}):t._e()}))]:t._e()],2),t._v(" "),t._m(0)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("footer",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 text-right"},[e("p",[this._v("By "),e("a",{attrs:{href:"http://twitter.com/mark_brough"}},[this._v("@mark_brough")])]),this._v(" "),e("p",[e("a",{attrs:{href:"http://github.com/markbrough/pwyf-visualisation"}},[this._v("Source code on Github")])])])])])}],!1,null,null,null));e.default=f.exports}}]);